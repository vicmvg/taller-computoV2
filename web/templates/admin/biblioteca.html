{% extends 'base.html' %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold">
                <i class="fas fa-book me-2"></i>Biblioteca Digital
            </h2>
            <p class="text-muted mb-0">Gestiona los libros y documentos disponibles</p>
        </div>
        <a href="{{ url_for('admin.agregar_libro') }}" class="btn btn-primary">
            <i class="fas fa-plus-circle me-2"></i>Agregar Libro
        </a>
    </div>

    <!-- Estadísticas -->
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="glass-card border-start border-4 border-primary p-3">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <h6 class="text-muted small mb-1">Total Libros</h6>
                        <h2 class="mb-0 text-primary">{{ total_libros }}</h2>
                    </div>
                    <i class="fas fa-book fa-2x text-primary opacity-50"></i>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="glass-card border-start border-4 border-success p-3">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <h6 class="text-muted small mb-1">Total Vistas</h6>
                        <h2 class="mb-0 text-success">{{ total_vistas }}</h2>
                    </div>
                    <i class="fas fa-eye fa-2x text-success opacity-50"></i>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="glass-card border-start border-4 border-info p-3">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <h6 class="text-muted small mb-1">Total Descargas</h6>
                        <h2 class="mb-0 text-info">{{ total_descargas }}</h2>
                    </div>
                    <i class="fas fa-download fa-2x text-info opacity-50"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtro por categoría -->
    <div class="glass-card p-3 mb-4">
        <div class="d-flex align-items-center gap-2 flex-wrap">
            <span class="fw-bold me-2"><i class="fas fa-filter me-1"></i>Filtrar:</span>
            <a href="{{ url_for('admin.gestionar_biblioteca', categoria='todos') }}" 
               class="btn btn-sm {{ 'btn-primary' if filtro_actual == 'todos' else 'btn-outline-primary' }}">
                Todos
            </a>
            {% for cat in categorias %}
            <a href="{{ url_for('admin.gestionar_biblioteca', categoria=cat) }}" 
               class="btn btn-sm {{ 'btn-primary' if filtro_actual == cat else 'btn-outline-primary' }}">
                {{ cat }}
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Lista de libros -->
    {% if libros %}
    <div class="row g-4">
        {% for libro in libros %}
        <div class="col-md-6 col-lg-4">
            <div class="glass-card h-100 overflow-hidden">
                <!-- Miniatura -->
                <div class="position-relative" style="height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    {% if libro.miniatura_url %}
                    <img src="{{ url_for('ver_archivo', archivo_path=libro.miniatura_url) }}" 
                         class="w-100 h-100" style="object-fit: cover;" alt="{{ libro.titulo }}">
                    {% else %}
                    <div class="d-flex align-items-center justify-content-center h-100">
                        <i class="fas fa-book fa-5x text-white opacity-50"></i>
                    </div>
                    {% endif %}
                    
                    <!-- Badge de categoría -->
                    <span class="position-absolute top-0 end-0 m-2 badge bg-dark">
                        {{ libro.categoria }}
                    </span>
                    
                    <!-- Badge de estado -->
                    {% if not libro.activo %}
                    <span class="position-absolute top-0 start-0 m-2 badge bg-danger">
                        Inactivo
                    </span>
                    {% endif %}
                </div>

                <!-- Contenido -->
                <div class="p-3">
                    <h5 class="fw-bold mb-2">{{ libro.titulo }}</h5>
                    {% if libro.autor %}
                    <p class="text-muted small mb-2">
                        <i class="fas fa-user me-1"></i>{{ libro.autor }}
                    </p>
                    {% endif %}
                    <p class="text-muted small mb-3" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                        {{ libro.descripcion }}
                    </p>

                    <!-- Estadísticas -->
                    <div class="d-flex gap-3 mb-3 small text-muted">
                        <span>
                            <i class="fas fa-eye me-1"></i>{{ libro.vistas }} vistas
                        </span>
                        <span>
                            <i class="fas fa-download me-1"></i>{{ libro.descargas }} descargas
                        </span>
                    </div>

                    <!-- Botones de acción -->
                    <div class="d-flex gap-2">
                        <a href="{{ url_for('admin.editar_libro', id=libro.id) }}" 
                           class="btn btn-sm btn-outline-primary flex-grow-1">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{{ url_for('admin.toggle_libro', id=libro.id) }}" 
                           class="btn btn-sm btn-outline-{{ 'success' if not libro.activo else 'warning' }}">
                            <i class="fas fa-{{ 'check' if not libro.activo else 'pause' }}"></i>
                        </a>
                        <a href="{{ url_for('admin.eliminar_libro', id=libro.id) }}" 
                           class="btn btn-sm btn-outline-danger"
                           onclick="return confirm('¿Eliminar {{ libro.titulo }}?')">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- Sin libros -->
    <div class="text-center py-5">
        <i class="fas fa-book-open fa-5x text-muted opacity-25 mb-4"></i>
        <h4 class="text-muted mb-3">No hay libros en la biblioteca</h4>
        <a href="{{ url_for('admin.agregar_libro') }}" class="btn btn-primary">
            <i class="fas fa-plus-circle me-2"></i>Agregar Primer Libro
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}